<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Celestial Registry â€” Frankie & Rodrigo</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050505;
      --lavender: #8B7BB8;
      --lavender-lt: #a99ad4;
      --lavender-dim: rgba(139, 123, 184, 0.15);
      --copper: #C4956A;
      --copper-lt: #d4ad85;
      --gold: #D4A853;
      --gold-glow: rgba(212, 168, 83, 0.4);
      --silver: #b8b8c0;
      --silver-muted: #9a9aa5;
      --btn-bg: #5b5189;
      --btn-hover: #6e63a3;
      --accept-color: #D4A853;
      --decline-color: #8B7BB8;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Raleway', sans-serif;
      font-weight: 400;
      color: var(--silver);
      background: var(--bg);
      line-height: 1.7;
      min-height: 100vh;
      overflow-x: hidden;
    }

    h1, h2, h3 {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 500;
      color: var(--lavender);
    }

    /* ========== STARFIELD BACKGROUND ========== */
    .starfield {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
      pointer-events: none;
    }
    .star {
      position: absolute;
      border-radius: 50%;
      background: #fff;
      animation: twinkle var(--dur) ease-in-out infinite;
    }
    @keyframes twinkle {
      0%, 100% { opacity: var(--o1); }
      50% { opacity: var(--o2); }
    }

    /* ========== LOGIN PORTAL ========== */
    .portal-overlay {
      position: fixed;
      inset: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: opacity 0.6s ease, visibility 0.6s;
    }
    .portal-overlay.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .portal-card {
      width: 300px;
      max-width: 90vw;
      perspective: 1000px;
    }

    .portal-card-inner {
      position: relative;
      width: 100%;
      padding-top: 150%;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .portal-card.flipping .portal-card-inner {
      transform: rotateY(180deg);
    }

    .portal-face {
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      border-radius: 12px;
      overflow: hidden;
    }

    /* Card back (visible initially) */
    .portal-back {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(160deg, rgba(22, 16, 42, 0.95), rgba(10, 6, 24, 0.98));
      border: 2px solid;
      border-image: linear-gradient(135deg, var(--lavender), var(--gold)) 1;
      border-radius: 12px;
      padding: 30px 24px;
      text-align: center;
      gap: 16px;
    }

    .portal-ornament-top,
    .portal-ornament-bot {
      font-size: 1.4rem;
      color: var(--gold);
      letter-spacing: 0.3em;
      opacity: 0.6;
    }

    .portal-numeral {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.85rem;
      letter-spacing: 0.2em;
      color: var(--silver-muted);
      text-transform: uppercase;
    }

    .portal-icon {
      font-size: 3.5rem;
      line-height: 1;
      color: var(--gold);
      text-shadow: 0 0 20px var(--gold-glow);
    }

    .portal-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.3rem;
      color: var(--lavender-lt);
      letter-spacing: 0.08em;
    }

    .portal-input-wrap {
      width: 100%;
    }

    .portal-input {
      width: 100%;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(139, 123, 184, 0.25);
      border-radius: 6px;
      padding: 10px 14px;
      font-family: inherit;
      font-size: 0.8rem;
      color: var(--silver);
      outline: none;
      text-align: center;
      letter-spacing: 0.15em;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .portal-input:focus {
      border-color: rgba(212, 168, 83, 0.5);
      box-shadow: 0 0 16px rgba(212, 168, 83, 0.1);
    }
    .portal-input::placeholder {
      color: var(--silver-muted);
      opacity: 0.5;
      font-style: italic;
    }

    .portal-error {
      color: #c85050;
      font-size: 0.75rem;
      min-height: 1.2em;
      margin-top: 6px;
    }

    .portal-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, var(--gold), var(--copper));
      color: #1a1020;
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: box-shadow 0.3s, transform 0.2s;
    }
    .portal-btn:hover {
      box-shadow: 0 0 24px var(--gold-glow);
      transform: translateY(-1px);
    }

    /* Card front (revealed after flip) */
    .portal-front {
      transform: rotateY(180deg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(160deg, rgba(22, 16, 42, 0.95), rgba(10, 6, 24, 0.98));
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 30px 24px;
      text-align: center;
      gap: 12px;
    }

    .portal-welcome-icon {
      font-size: 4rem;
      line-height: 1;
      color: var(--gold);
      text-shadow: 0 0 30px var(--gold-glow);
      animation: pulseGlow 2s ease-in-out infinite;
    }

    .portal-welcome-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.4rem;
      color: var(--lavender-lt);
    }

    .portal-welcome-sub {
      font-size: 0.8rem;
      color: var(--copper-lt);
      font-style: italic;
    }

    /* Shake animation for wrong key */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-12px); }
      40% { transform: translateX(10px); }
      60% { transform: translateX(-8px); }
      80% { transform: translateX(6px); }
    }
    .portal-card.shake .portal-card-inner {
      animation: shake 0.5s ease;
    }

    @keyframes pulseGlow {
      0%, 100% { text-shadow: 0 0 20px var(--gold-glow); }
      50% { text-shadow: 0 0 40px rgba(212, 168, 83, 0.7); }
    }

    /* ========== DASHBOARD ========== */
    .dashboard {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 860px;
      margin: 0 auto;
      padding: 30px 20px 60px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease 0.3s, transform 0.8s ease 0.3s;
      pointer-events: none;
    }
    .dashboard.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    /* ---- Header ---- */
    .dash-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 36px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .dash-brand h1 {
      font-size: 1.6rem;
      line-height: 1.2;
    }
    .dash-brand p {
      font-size: 0.78rem;
      color: var(--copper);
    }

    .dash-meta {
      text-align: right;
    }

    .moon-widget {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(139, 123, 184, 0.08);
      border: 1px solid var(--lavender-dim);
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 0.75rem;
      color: var(--silver-muted);
      letter-spacing: 0.05em;
    }
    .moon-widget-icon {
      font-size: 1.1rem;
    }
    .moon-widget-text {
      white-space: nowrap;
    }

    .dash-exit {
      display: block;
      margin-top: 6px;
      background: none;
      border: none;
      color: var(--silver-muted);
      font-family: inherit;
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      cursor: pointer;
      text-align: right;
      width: 100%;
      opacity: 0.6;
      transition: opacity 0.3s;
    }
    .dash-exit:hover { opacity: 1; }

    /* ---- Triptych Stats ---- */
    .triptych {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-bottom: 28px;
    }

    .triptych-panel {
      background: linear-gradient(160deg, rgba(22, 16, 42, 0.9), rgba(10, 6, 24, 0.95));
      border: 1px solid var(--lavender-dim);
      border-radius: 12px;
      padding: 28px 16px 22px;
      text-align: center;
      position: relative;
      overflow: hidden;
      transition: border-color 0.4s, transform 0.3s, box-shadow 0.4s;
    }
    .triptych-panel:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .triptych-panel--sun { border-color: rgba(212, 168, 83, 0.25); }
    .triptych-panel--sun:hover { border-color: rgba(212, 168, 83, 0.5); }
    .triptych-panel--moon { border-color: rgba(139, 123, 184, 0.25); }
    .triptych-panel--moon:hover { border-color: rgba(139, 123, 184, 0.5); }
    .triptych-panel--stars { border-color: rgba(184, 184, 192, 0.15); }
    .triptych-panel--stars:hover { border-color: rgba(184, 184, 192, 0.3); }

    .triptych-icon {
      font-size: 2.2rem;
      line-height: 1;
      margin-bottom: 10px;
    }
    .triptych-panel--sun .triptych-icon {
      color: var(--gold);
      text-shadow: 0 0 16px var(--gold-glow);
      animation: pulseGlow 3s ease-in-out infinite;
    }
    .triptych-panel--moon .triptych-icon {
      color: var(--lavender-lt);
      text-shadow: 0 0 12px rgba(139, 123, 184, 0.4);
    }
    .triptych-panel--stars .triptych-icon {
      color: var(--silver);
      text-shadow: 0 0 8px rgba(184, 184, 192, 0.3);
    }

    .triptych-number {
      font-family: 'Cormorant Garamond', serif;
      font-size: 2.6rem;
      font-weight: 600;
      line-height: 1;
      margin-bottom: 2px;
    }
    .triptych-panel--sun .triptych-number { color: var(--gold); }
    .triptych-panel--moon .triptych-number { color: var(--lavender-lt); }
    .triptych-panel--stars .triptych-number { color: var(--silver); }

    .triptych-label {
      font-size: 0.7rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--silver-muted);
      margin-bottom: 6px;
    }

    .triptych-sub {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 0.78rem;
      color: var(--silver-muted);
      opacity: 0.7;
    }

    /* Moon phase visual */
    .moon-phase-visual {
      width: 36px;
      height: 36px;
      margin: 8px auto 4px;
      border-radius: 50%;
      position: relative;
      background: #1a1a2e;
      box-shadow: 0 0 12px rgba(139, 123, 184, 0.3);
      overflow: hidden;
    }
    .moon-phase-light {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #e8e8f0, #b8b8cc);
      transition: clip-path 1s ease;
    }

    /* ---- Celebration Meter ---- */
    .meter-section {
      margin-bottom: 32px;
    }
    .meter-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }
    .meter-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.9rem;
      color: var(--silver-muted);
      font-style: italic;
    }
    .meter-pct {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.85rem;
      color: var(--gold);
    }

    .meter-track {
      width: 100%;
      height: 8px;
      background: rgba(139, 123, 184, 0.1);
      border: 1px solid var(--lavender-dim);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .meter-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--lavender), var(--gold));
      border-radius: 10px;
      transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    .meter-fill::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.25) 50%, transparent 100%);
      animation: shimmer 2s linear infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(200%); }
    }

    .meter-milestones {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      padding: 0 2px;
    }
    .milestone {
      font-size: 0.65rem;
      color: var(--silver-muted);
      opacity: 0.4;
      transition: opacity 0.4s, color 0.4s;
    }
    .milestone.reached {
      opacity: 1;
      color: var(--gold);
    }
    .milestone.current {
      opacity: 1;
      color: var(--lavender-lt);
    }

    /* ---- Registry Section ---- */
    .registry {
      background: linear-gradient(160deg, rgba(22, 16, 42, 0.85), rgba(10, 6, 24, 0.92));
      border: 1px solid var(--lavender-dim);
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 28px;
    }

    .registry-header {
      padding: 22px 24px 18px;
      border-bottom: 1px solid rgba(139, 123, 184, 0.08);
    }

    .registry-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 4px;
    }

    .registry-title {
      font-size: 1.3rem;
    }

    .registry-subtitle {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 0.82rem;
      color: var(--silver-muted);
      opacity: 0.7;
      margin-bottom: 14px;
    }

    .registry-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-pills {
      display: flex;
      gap: 6px;
    }
    .pill {
      background: rgba(139, 123, 184, 0.06);
      border: 1px solid rgba(139, 123, 184, 0.15);
      color: var(--silver-muted);
      font-family: inherit;
      font-size: 0.68rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 5px 12px;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }
    .pill:hover {
      border-color: rgba(139, 123, 184, 0.4);
      color: var(--lavender-lt);
    }
    .pill.active {
      background: rgba(139, 123, 184, 0.15);
      border-color: var(--lavender);
      color: var(--lavender-lt);
      box-shadow: 0 0 12px rgba(139, 123, 184, 0.15);
    }

    .soul-search {
      flex: 1;
      min-width: 140px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(139, 123, 184, 0.15);
      border-radius: 16px;
      padding: 5px 14px;
      font-family: inherit;
      font-size: 0.72rem;
      color: var(--silver);
      outline: none;
      transition: border-color 0.3s;
    }
    .soul-search:focus {
      border-color: var(--lavender);
    }
    .soul-search::placeholder {
      color: var(--silver-muted);
      opacity: 0.5;
      font-style: italic;
    }

    .registry-refresh {
      background: none;
      border: 1px solid rgba(139, 123, 184, 0.2);
      color: var(--silver-muted);
      font-family: inherit;
      font-size: 0.68rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 5px 12px;
      border-radius: 16px;
      cursor: pointer;
      transition: border-color 0.3s, color 0.3s;
      white-space: nowrap;
    }
    .registry-refresh:hover {
      border-color: var(--lavender);
      color: var(--lavender-lt);
    }

    /* Guest Cards */
    .guest-list {
      padding: 8px 16px 16px;
    }

    .guest-card {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 16px;
      margin-bottom: 8px;
      border-radius: 10px;
      border-left: 3px solid transparent;
      background: rgba(255, 255, 255, 0.015);
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(12px);
    }
    .guest-card.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .guest-card:last-child { margin-bottom: 0; }

    .guest-card:hover {
      background: rgba(139, 123, 184, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    .guest-card--accept {
      border-left-color: var(--gold);
    }
    .guest-card--decline {
      border-left-color: rgba(139, 123, 184, 0.4);
      opacity: 0.7;
    }
    .guest-card--decline.visible { opacity: 0.7; }

    .guest-star {
      font-size: 1.1rem;
      flex-shrink: 0;
      width: 28px;
      text-align: center;
    }
    .guest-card--accept .guest-star {
      color: var(--gold);
      text-shadow: 0 0 8px var(--gold-glow);
    }
    .guest-card--decline .guest-star {
      color: var(--silver-muted);
      opacity: 0.5;
    }

    .guest-info {
      flex: 1;
      min-width: 0;
    }
    .guest-name {
      font-size: 0.9rem;
      color: #e0e0e8;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .guest-card--decline .guest-name {
      color: var(--silver-muted);
    }
    .guest-date {
      font-size: 0.68rem;
      color: var(--silver-muted);
      opacity: 0.7;
    }

    .guest-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 14px;
      font-size: 0.62rem;
      font-weight: 500;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .guest-badge--accept {
      background: rgba(212, 168, 83, 0.12);
      color: var(--gold);
      border: 1px solid rgba(212, 168, 83, 0.3);
    }
    .guest-badge--decline {
      background: rgba(139, 123, 184, 0.08);
      color: var(--lavender);
      border: 1px solid rgba(139, 123, 184, 0.2);
    }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--silver-muted);
    }
    .empty-state-icon {
      font-size: 2.5rem;
      margin-bottom: 12px;
      opacity: 0.4;
    }
    .empty-state-text {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 1rem;
    }

    .loading {
      text-align: center;
      padding: 48px 24px;
      color: var(--silver-muted);
      font-style: italic;
    }

    /* ---- Recent Alignments ---- */
    .alignments {
      background: linear-gradient(160deg, rgba(22, 16, 42, 0.85), rgba(10, 6, 24, 0.92));
      border: 1px solid var(--lavender-dim);
      border-radius: 14px;
      padding: 20px 22px;
      margin-bottom: 28px;
    }
    .alignments-title {
      font-size: 1rem;
      margin-bottom: 14px;
    }
    .alignment-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(139, 123, 184, 0.06);
      font-size: 0.8rem;
    }
    .alignment-item:last-child { border-bottom: none; }
    .alignment-icon {
      color: var(--gold);
      font-size: 0.9rem;
    }
    .alignment-text {
      flex: 1;
      color: var(--silver);
    }
    .alignment-text strong {
      color: #e0e0e8;
      font-weight: 500;
    }
    .alignment-time {
      font-size: 0.68rem;
      color: var(--silver-muted);
      opacity: 0.6;
      white-space: nowrap;
    }

    .alignments-empty {
      text-align: center;
      padding: 16px;
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      color: var(--silver-muted);
      opacity: 0.6;
      font-size: 0.85rem;
    }

    /* ---- Footer ---- */
    .admin-footer {
      text-align: center;
      padding-bottom: 20px;
    }
    .admin-footer a {
      color: var(--lavender);
      text-decoration: none;
      font-size: 0.8rem;
      opacity: 0.7;
      transition: opacity 0.3s;
    }
    .admin-footer a:hover { opacity: 1; }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 600px) {
      .triptych { grid-template-columns: repeat(3, 1fr); gap: 8px; }
      .triptych-panel { padding: 18px 8px 16px; }
      .triptych-icon { font-size: 1.6rem; }
      .triptych-number { font-size: 2rem; }
      .triptych-sub { display: none; }
      .moon-phase-visual { width: 28px; height: 28px; }

      .dash-header { flex-direction: column; align-items: flex-start; }
      .dash-meta { text-align: left; }

      .filter-pills { flex-wrap: wrap; }
      .soul-search { min-width: 100%; order: -1; }

      .guest-card { padding: 12px; gap: 10px; }
      .guest-badge { padding: 2px 8px; font-size: 0.58rem; }

      .portal-card { width: 260px; }

      .registry-header { padding: 18px 16px 14px; }
      .guest-list { padding: 8px 10px 12px; }
    }

    @media (min-width: 601px) and (max-width: 860px) {
      .portal-card { width: 280px; }
    }

    /* ========== REDUCED MOTION ========== */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.2s !important;
      }
      .star { animation: none !important; opacity: var(--o1) !important; }
    }
  </style>
</head>
<body>

  <!-- Starfield Background -->
  <div class="starfield" id="starfield" aria-hidden="true"></div>

  <!-- Login Portal -->
  <div class="portal-overlay" id="portal">
    <div class="portal-card" id="portal-card">
      <div class="portal-card-inner">
        <!-- Back: login form -->
        <div class="portal-face portal-back">
          <div class="portal-ornament-top">&#10022; &#10022; &#10022;</div>
          <div class="portal-numeral">The Administrators</div>
          <div class="portal-icon">&#9878;</div>
          <div class="portal-title">Celestial Registry</div>
          <div class="portal-input-wrap">
            <input type="password" class="portal-input" id="admin-key" placeholder="Speak the celestial key..." autocomplete="off">
            <p class="portal-error" id="portal-error"></p>
          </div>
          <button class="portal-btn" id="login-btn">
            <span id="login-btn-text">Unveil</span>
          </button>
          <div class="portal-ornament-bot">&#10022; &#10022; &#10022;</div>
        </div>
        <!-- Front: welcome message -->
        <div class="portal-face portal-front">
          <div class="portal-welcome-icon">&#10022;</div>
          <div class="portal-welcome-title">The Stars Welcome You</div>
          <div class="portal-welcome-sub">Opening the celestial registry...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">

    <!-- Header -->
    <div class="dash-header">
      <div class="dash-brand">
        <h1>Frankie &amp; Rodrigo</h1>
        <p>October 15, 2026 &bull; Westbury Manor</p>
      </div>
      <div class="dash-meta">
        <div class="moon-widget" id="moon-widget">
          <span class="moon-widget-icon">&#9790;</span>
          <span class="moon-widget-text" id="moon-countdown"></span>
        </div>
        <button class="dash-exit" id="exit-btn">Exit Portal</button>
      </div>
    </div>

    <!-- Triptych Stats -->
    <div class="triptych">
      <!-- Sun: Total -->
      <div class="triptych-panel triptych-panel--sun">
        <div class="triptych-icon">&#9788;</div>
        <div class="triptych-number" id="stat-total">0</div>
        <div class="triptych-label">Souls Responded</div>
        <div class="triptych-sub" id="stat-total-sub"></div>
      </div>
      <!-- Moon: Accepted -->
      <div class="triptych-panel triptych-panel--moon">
        <div class="triptych-icon">&#9790;</div>
        <div class="triptych-number" id="stat-accepted">0</div>
        <div class="triptych-label">Souls Aligned</div>
        <div class="moon-phase-visual" id="moon-phase">
          <div class="moon-phase-light" id="moon-phase-light"></div>
        </div>
        <div class="triptych-sub" id="stat-moon-phase"></div>
      </div>
      <!-- Stars: Declined -->
      <div class="triptych-panel triptych-panel--stars">
        <div class="triptych-icon">&#10027;</div>
        <div class="triptych-number" id="stat-declined">0</div>
        <div class="triptych-label">Wandering Stars</div>
        <div class="triptych-sub">Awaiting alignment</div>
      </div>
    </div>

    <!-- Celebration Meter -->
    <div class="meter-section">
      <div class="meter-header">
        <div class="meter-title" id="meter-message">The journey begins...</div>
        <div class="meter-pct" id="meter-pct">0%</div>
      </div>
      <div class="meter-track">
        <div class="meter-fill" id="meter-fill" style="width: 0%"></div>
      </div>
      <div class="meter-milestones">
        <span class="milestone" id="ms-0">The journey begins</span>
        <span class="milestone" id="ms-1">Stars aligning</span>
        <span class="milestone" id="ms-2">Cosmos converges</span>
        <span class="milestone" id="ms-3">Destiny fulfilled</span>
      </div>
    </div>

    <!-- Recent Alignments -->
    <div class="alignments" id="alignments-section">
      <h3 class="alignments-title">&#10022; Recent Alignments</h3>
      <div id="alignments-body">
        <p class="alignments-empty">Awaiting the first soul...</p>
      </div>
    </div>

    <!-- Celestial Registry (Guest List) -->
    <div class="registry">
      <div class="registry-header">
        <div class="registry-title-row">
          <h2 class="registry-title">The Celestial Registry</h2>
        </div>
        <p class="registry-subtitle">"These souls shall bear witness to the union"</p>
        <div class="registry-controls">
          <div class="filter-pills" id="filter-pills">
            <button class="pill active" data-filter="all">All</button>
            <button class="pill" data-filter="accept">&#9733; Aligned</button>
            <button class="pill" data-filter="decline">&#9734; Wandering</button>
          </div>
          <input type="search" class="soul-search" id="soul-search" placeholder="Seek a soul...">
          <button class="registry-refresh" id="refresh-btn">Refresh</button>
        </div>
      </div>
      <div class="guest-list" id="guest-list">
        <p class="loading">Consulting the cosmos...</p>
      </div>
    </div>

    <!-- Footer -->
    <div class="admin-footer">
      <a href="index.html">&larr; Return to the wedding site</a>
    </div>

  </div>

  <script>
    (function () {
      const API_BASE = window.location.hostname === 'localhost'
        ? 'http://localhost:3001/api'
        : 'https://boda-rodrigo-production.up.railway.app/api';

      // ---- Elements ----
      const portal = document.getElementById('portal');
      const portalCard = document.getElementById('portal-card');
      const dashboard = document.getElementById('dashboard');
      const keyInput = document.getElementById('admin-key');
      const loginBtn = document.getElementById('login-btn');
      const loginBtnText = document.getElementById('login-btn-text');
      const portalError = document.getElementById('portal-error');
      const refreshBtn = document.getElementById('refresh-btn');
      const searchInput = document.getElementById('soul-search');
      const filterPills = document.getElementById('filter-pills');
      const exitBtn = document.getElementById('exit-btn');

      let adminKey = '';
      let allRsvps = [];
      let currentFilter = 'all';

      // ---- Starfield ----
      (function initStarfield() {
        const container = document.getElementById('starfield');
        const count = window.innerWidth < 600 ? 60 : 120;
        for (let i = 0; i < count; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          const size = 1 + Math.random() * 2;
          const o1 = (0.2 + Math.random() * 0.4).toFixed(2);
          const o2 = (0.6 + Math.random() * 0.4).toFixed(2);
          const dur = (2 + Math.random() * 4).toFixed(1);
          star.style.cssText = `
            left:${Math.random() * 100}%;top:${Math.random() * 100}%;
            width:${size}px;height:${size}px;
            --o1:${o1};--o2:${o2};--dur:${dur}s;
            animation-delay:${(Math.random() * 4).toFixed(1)}s;
          `;
          container.appendChild(star);
        }
      })();

      // ---- Moon countdown ----
      (function initMoonCountdown() {
        const wedding = new Date('2026-10-15T17:00:00');
        const now = new Date();
        const diff = wedding - now;
        const days = Math.max(0, Math.floor(diff / (1000 * 60 * 60 * 24)));
        const moons = Math.floor(days / 29.5);
        const el = document.getElementById('moon-countdown');
        if (days > 60) {
          el.textContent = `${moons} moons remaining`;
        } else if (days > 0) {
          el.textContent = `${days} days remaining`;
        } else {
          el.textContent = 'The day has arrived';
        }
      })();

      // ---- Login ----
      loginBtn.addEventListener('click', tryLogin);
      keyInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') tryLogin();
      });

      async function tryLogin() {
        adminKey = keyInput.value.trim();
        if (!adminKey) {
          portalError.textContent = 'The key cannot be empty';
          return;
        }

        portalError.textContent = '';
        loginBtnText.textContent = 'Reading the stars...';
        loginBtn.disabled = true;

        try {
          const res = await fetch(`${API_BASE}/rsvps`, {
            headers: { 'x-admin-key': adminKey },
          });

          if (res.status === 401) {
            portalError.textContent = 'The stars do not align...';
            loginBtnText.textContent = 'Unveil';
            loginBtn.disabled = false;
            portalCard.classList.add('shake');
            setTimeout(() => portalCard.classList.remove('shake'), 600);
            return;
          }

          if (!res.ok) throw new Error('Server error');

          const data = await res.json();

          // Flip the card to reveal welcome
          portalCard.classList.add('flipping');

          // After flip, fade out portal and show dashboard
          setTimeout(() => {
            portal.classList.add('hidden');
            dashboard.classList.add('visible');
            renderDashboard(data);
          }, 1200);

        } catch (err) {
          portalError.textContent = 'Could not reach the cosmos. Try again.';
          loginBtnText.textContent = 'Unveil';
          loginBtn.disabled = false;
        }
      }

      // ---- Exit ----
      exitBtn.addEventListener('click', () => {
        dashboard.classList.remove('visible');
        setTimeout(() => {
          portal.classList.remove('hidden');
          portalCard.classList.remove('flipping');
          loginBtnText.textContent = 'Unveil';
          loginBtn.disabled = false;
          keyInput.value = '';
          adminKey = '';
        }, 400);
      });

      // ---- Refresh ----
      refreshBtn.addEventListener('click', async () => {
        refreshBtn.textContent = 'Consulting...';
        try {
          const res = await fetch(`${API_BASE}/rsvps`, {
            headers: { 'x-admin-key': adminKey },
          });
          if (!res.ok) throw new Error();
          const data = await res.json();
          renderDashboard(data);
        } catch {
          // silent
        }
        refreshBtn.textContent = 'Refresh';
      });

      // ---- Filters ----
      filterPills.addEventListener('click', (e) => {
        const pill = e.target.closest('.pill');
        if (!pill) return;
        filterPills.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
        pill.classList.add('active');
        currentFilter = pill.dataset.filter;
        renderGuestList();
      });

      // ---- Search ----
      searchInput.addEventListener('input', () => renderGuestList());

      // ---- Render Dashboard ----
      function renderDashboard(data) {
        const { stats, rsvps } = data;
        allRsvps = rsvps;

        // Stats
        document.getElementById('stat-total').textContent = stats.total;
        document.getElementById('stat-accepted').textContent = stats.accepted;
        document.getElementById('stat-declined').textContent = stats.declined;

        // Sun sub
        const totalSub = document.getElementById('stat-total-sub');
        if (stats.total === 0) {
          totalSub.textContent = 'Awaiting responses';
        } else {
          const hc = stats.acceptedHeadCount || stats.accepted;
          totalSub.textContent = `${hc} guests attending`;
        }

        // Moon phase
        updateMoonPhase(stats.accepted, stats.total);

        // Celebration meter
        updateMeter(stats.accepted, stats.total);

        // Recent alignments
        renderAlignments(rsvps.slice(0, 5));

        // Guest list
        renderGuestList();
      }

      // ---- Moon Phase ----
      function updateMoonPhase(accepted, total) {
        const pct = total === 0 ? 0 : (accepted / total) * 100;
        const moonLight = document.getElementById('moon-phase-light');
        const phaseLabel = document.getElementById('stat-moon-phase');

        const phases = [
          { max: 12, name: 'New Moon', clip: 'inset(0 100% 0 0)' },
          { max: 25, name: 'Waxing Crescent', clip: 'inset(0 75% 0 0)' },
          { max: 50, name: 'First Quarter', clip: 'inset(0 50% 0 0)' },
          { max: 75, name: 'Waxing Gibbous', clip: 'inset(0 25% 0 0)' },
          { max: 100, name: 'Full Moon', clip: 'inset(0 0% 0 0)' },
        ];

        const phase = phases.find(p => pct <= p.max) || phases[phases.length - 1];
        moonLight.style.clipPath = phase.clip;
        phaseLabel.textContent = phase.name;
      }

      // ---- Celebration Meter ----
      function updateMeter(accepted, total) {
        const pct = total === 0 ? 0 : Math.round((accepted / total) * 100);
        document.getElementById('meter-fill').style.width = pct + '%';
        document.getElementById('meter-pct').textContent = pct + '% aligned';

        const messages = [
          { min: 0, text: 'The journey begins...' },
          { min: 25, text: 'The stars are stirring...' },
          { min: 50, text: 'The cosmos converges...' },
          { min: 75, text: 'Destiny draws near...' },
          { min: 90, text: 'The universe has spoken!' },
        ];
        const msg = [...messages].reverse().find(m => pct >= m.min);
        document.getElementById('meter-message').textContent = msg.text;

        // Milestones
        const thresholds = [0, 25, 50, 75];
        thresholds.forEach((t, i) => {
          const el = document.getElementById('ms-' + i);
          if (pct >= t + 25) {
            el.classList.add('reached');
            el.classList.remove('current');
          } else if (pct >= t) {
            el.classList.add('current');
            el.classList.remove('reached');
          } else {
            el.classList.remove('reached', 'current');
          }
        });
      }

      // ---- Recent Alignments ----
      function renderAlignments(recent) {
        const body = document.getElementById('alignments-body');
        if (!recent.length) {
          body.innerHTML = '<p class="alignments-empty">Awaiting the first soul...</p>';
          return;
        }

        body.innerHTML = recent.map(r => {
          const timeAgo = getTimeAgo(new Date(r.createdAt));
          const verb = r.attendance === 'accept' ? 'aligned with the stars' : 'wanders still';
          const icon = r.attendance === 'accept' ? '&#10022;' : '&#10023;';
          const name = r.displayName || r.name || 'Unknown';
          return `
            <div class="alignment-item">
              <span class="alignment-icon">${icon}</span>
              <span class="alignment-text"><strong>${escapeHtml(name)}</strong> ${verb}</span>
              <span class="alignment-time">${timeAgo}</span>
            </div>
          `;
        }).join('');
      }

      // ---- Guest List ----
      function renderGuestList() {
        const container = document.getElementById('guest-list');
        const query = searchInput.value.trim().toLowerCase();

        let filtered = allRsvps;
        if (currentFilter !== 'all') {
          filtered = filtered.filter(r => r.attendance === currentFilter);
        }
        if (query) {
          filtered = filtered.filter(r => {
            const name = (r.displayName || r.name || '').toLowerCase();
            const members = (r.members || []).join(' ').toLowerCase();
            const respondedBy = (r.respondedBy || '').toLowerCase();
            return name.includes(query) || members.includes(query) || respondedBy.includes(query);
          });
        }

        if (!filtered.length) {
          const noResults = allRsvps.length === 0;
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">${noResults ? '&#9790;' : '&#10027;'}</div>
              <div class="empty-state-text">${noResults ? 'No souls have responded yet. Share the invitation!' : 'No souls match your search.'}</div>
            </div>
          `;
          return;
        }

        container.innerHTML = filtered.map((r, i) => {
          const isAccept = r.attendance === 'accept';
          const date = new Date(r.createdAt).toLocaleDateString('en-US', {
            month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit',
          });
          const starIcon = isAccept ? '&#9733;' : '&#9734;';
          const badgeClass = isAccept ? 'guest-badge--accept' : 'guest-badge--decline';
          const badgeText = isAccept ? 'Aligned' : 'Wandering';
          const cardClass = isAccept ? 'guest-card--accept' : 'guest-card--decline';
          const displayName = r.displayName || r.name || 'Unknown';
          const headCount = r.headCount || 1;
          const respondedBy = r.respondedBy ? `by ${escapeHtml(r.respondedBy)}` : '';

          return `
            <div class="guest-card ${cardClass}" style="transition-delay: ${i * 40}ms">
              <div class="guest-star">${starIcon}</div>
              <div class="guest-info">
                <div class="guest-name">${escapeHtml(displayName)}</div>
                <div class="guest-date">${date}${respondedBy ? ' &middot; ' + respondedBy : ''}</div>
              </div>
              ${headCount > 1 ? `<span class="guest-badge" style="background:rgba(139,123,184,0.08);color:var(--silver-muted);border:1px solid rgba(139,123,184,0.15);margin-right:4px;">${headCount} guests</span>` : ''}
              <span class="guest-badge ${badgeClass}">${badgeText}</span>
            </div>
          `;
        }).join('');

        // Stagger card animations
        requestAnimationFrame(() => {
          container.querySelectorAll('.guest-card').forEach(card => {
            card.classList.add('visible');
          });
        });
      }

      // ---- Helpers ----
      function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      function getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const mins = Math.floor(diffMs / 60000);
        const hours = Math.floor(diffMs / 3600000);
        const days = Math.floor(diffMs / 86400000);

        if (mins < 1) return 'Just now';
        if (mins < 60) return `${mins}m ago`;
        if (hours < 24) return `${hours}h ago`;
        if (days < 7) return `${days}d ago`;
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      }

    })();
  </script>
</body>
</html>
